{{ define "css-home" }}
    <link rel="stylesheet" href="/static/lib/clr-icons.min.css">
    <link href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css" type="text/css" rel="stylesheet">
{{ end }}

{{ define "js-home" }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js" type="text/javascript" defer></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" type="text/javascript" defer></script>
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js" type="text/javascript" defer></script>
<script src="/static/lib/clr-icons.min.js" defer></script>
<script src="/static/home/index.js" type="text/javascript" defer></script>
{{ end }}


{{ define "header-home" }}
<h1 class="header-title">
    <a href="/">Pipelines</a>
    {{ if (isAvailable . "Owner") }}
        &gt; <a href="/{{ .Owner }}">{{ .Owner }}</a>
        {{ if (isAvailable . "Repository") }}
            &gt; <a href="/{{ .Owner }}/{{ .Repository }}">{{ .Repository }}</a>
            {{ if (isAvailable . "Branch") }}
                &gt; <a href="/{{ .Owner }}/{{ .Repository }}/{{ .Branch }}">{{ .Branch }}</a>
            {{ end }}
        {{ end }}
    {{ end }}
  </h1>

<!-- <input type="text" placeholder="Search Pipelines (not implemented)" /> -->
{{ end }}

<section class="in-building">
    <div class="pipeline-cards">
        {{- range list "Pending" "Running" "Failed" "Succeeded" -}}
        {{- $pipelines := index $.Pipelines.Counts.Statuses . -}}
        {{- if gt $pipelines 0 -}}
        <div class="pipeline-card pipeline-card-{{ lower . }}">
            <span><a href="/?q={{ . }}">{{ $pipelines }} {{ . }}</a></span>
        </div>
        {{- end -}}
        {{- end -}}
    </div>
</section>
<section class="dataTable-container">
    <table id="dataTable" class="display cell-border">
        <thead>
            <tr>
                <th class="repository">Repository</th>
                <th class="branch">Branch</th>
                <th class="build">Build</th>
                <th class="context">Context</th>
                <th class="status">Status</th>
                <th class="start">Start</th>
                <th class="end">End</th>
                <th class="duration">Duration</th>
                <th class="author"></th>
            </tr>
        </thead>
        <tbody>
            {{ range .Pipelines.Pipelines }}
            <tr>
                <td>
                    <a href="/{{ .Owner }}/{{ .Repository }}">{{ .Owner }}/{{ .Repository }}</a>
                    {{- if repositoryURL . -}}
                    <span>
                        <a href="{{ repositoryURL . }}"><clr-icon shape="pop-out" size="12"></clr-icon></a>
                    </span>
                    {{- end -}}
                </td>
                <td data-order="{{ .Branch }}">
                    {{- if authorURL . -}}
                    <a href="{{ authorURL . }}"><img src='{{ if not .AuthorAvatarURL }}{{ "/static/avatar.png" }}{{ else }}{{ .AuthorAvatarURL }}{{ end }}' title="{{ .Author }}" width="20px"></a>
                    {{- else -}}
                    <img src='{{ if not .AuthorAvatarURL }}{{ "/static/avatar.png" }}{{ else }}{{ .AuthorAvatarURL }}{{ end }}' title="{{ .Author }}" width="20px">
                    {{- end -}}
                    <span>
                        <a href="/{{ .Owner }}/{{ .Repository }}/{{ .Branch }}">{{ .Branch }}</a>
                    </span>
                    {{- if branchURL . -}}
                    <span>
                        <a href="{{ branchURL . }}"><clr-icon shape="pop-out" size="12"></clr-icon></a>
                    </span>
                    {{- end -}}
                </td>
                <td><a href="/{{ .Owner }}/{{ .Repository }}/{{ .Branch }}/{{ .Build }}">{{ .Build }}</a></td>
                <td>{{ .Context }}</td>
                <td class="status-{{ lower .Status }}" title="{{ .Description }}">{{ .Status }}</td>
                <td data-order='{{ .Start.Format "2006-01-02 15:04:05" }}'>
                    {{- if (vdate .Start).IsToday -}}
                        {{ .Start.Format "15:04:05" }}
                    {{- else -}}
                        {{ .Start.Format "2006-01-02 15:04:05" }}
                    {{- end -}}
                </td>
                <td data-order='{{ if not .End.IsZero }}{{ .End.Format "2006-01-02 15:04:05" }}{{ end }}'>
                    {{- if not .End.IsZero }}
                        {{- if (vdate .End).IsToday -}}
                            {{ .End.Format "15:04:05" }}
                        {{- else -}}
                            {{ .End.Format "2006-01-02 15:04:05" }}
                        {{- end -}}
                    {{- end -}}
                </td>
                <td data-order="{{ .Duration.Seconds }}">{{ with .Duration }}{{ . }}{{ end }}</td>
                <td>{{ .Author }}</td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</section>